# Multi-Server Architecture

## Naming Scheme

```
SERVERS = Adjectives / Verbs              SESSIONS = Nouns
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”¥ blazing   â„ï¸ frozen   âš¡ swift          ğŸ¦Š fox    ğŸ» bear   ğŸ¦‰ owl
ğŸŒ€ rising    ğŸ‚ falling  ğŸŒŠ rushing        ğŸŒ™ moon   â­ star   ğŸ”¥ fire
âœ¨ bright    ğŸŒ‘ dark     ğŸ’« spinning       ğŸº wolf   ğŸ¦ lion   ğŸ‹ whale

Combined: "ğŸ”¥ blazing ğŸ¦Š fox" = server + session = natural phrase
```

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ~/.jcode/servers.json                               â”‚
â”‚                           (Server Registry)                                 â”‚
â”‚  {                                                                          â”‚
â”‚    "blazing": { socket: "...", git_hash: "abc1234", sessions: [...] },      â”‚
â”‚    "frozen":  { socket: "...", git_hash: "def5678", sessions: [...] }       â”‚
â”‚  }                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ discovery
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              CLIENT (TUI)                                   â”‚
â”‚                                                                             â”‚
â”‚   Reads registry â†’ Shows servers â†’ User picks â†’ Connects to socket          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”¥ BLAZING          â”‚   â”‚ â„ï¸ FROZEN           â”‚   â”‚ ğŸŒ€ RISING           â”‚
â”‚ v0.1.1 (abc1234)    â”‚   â”‚ v0.1.2 (def5678)    â”‚   â”‚ v0.1.3 (ghi9012)    â”‚
â”‚                     â”‚   â”‚                     â”‚   â”‚                     â”‚
â”‚ blazing.sock        â”‚   â”‚ frozen.sock         â”‚   â”‚ rising.sock         â”‚
â”‚                     â”‚   â”‚                     â”‚   â”‚                     â”‚
â”‚ Sessions:           â”‚   â”‚ Sessions:           â”‚   â”‚ Sessions:           â”‚
â”‚   ğŸ¦Š fox            â”‚   â”‚   ğŸ» bear           â”‚   â”‚   (none)            â”‚
â”‚   ğŸ¦‰ owl            â”‚   â”‚                     â”‚   â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Socket Paths

```
/run/user/$UID/jcode/
â”œâ”€â”€ blazing.sock
â”œâ”€â”€ blazing-debug.sock
â”œâ”€â”€ frozen.sock
â”œâ”€â”€ frozen-debug.sock
â””â”€â”€ rising.sock
```

## Self-Dev Workflow

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  $ jcode  (in jcode repo)                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Build canary â†’ get git hash                â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Hash exists in       â”‚               â”‚  Hash NOT in          â”‚
        â”‚  registry?            â”‚               â”‚  registry             â”‚
        â”‚                       â”‚               â”‚                       â”‚
        â”‚  â†’ Connect to         â”‚               â”‚  â†’ Spawn NEW server   â”‚
        â”‚    existing server    â”‚               â”‚  â†’ Generate name      â”‚
        â”‚  â†’ Create session     â”‚               â”‚  â†’ Register           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


  EXAMPLE:

  1. First run (hash: abc1234)
     â†’ Spawn "ğŸ”¥ blazing", create "ğŸ¦Š fox"
     â†’ Display: "ğŸ”¥ blazing ğŸ¦Š fox"

  2. Make changes, run again (hash: def5678)
     â†’ Spawn "â„ï¸ frozen", create "ğŸ» bear"
     â†’ Display: "â„ï¸ frozen ğŸ» bear"
     â†’ "ğŸ”¥ blazing ğŸ¦Š fox" still running!

  3. Run again, no changes (hash: def5678)
     â†’ Server "â„ï¸ frozen" exists
     â†’ Connect to it, create "ğŸ¦‰ owl"
     â†’ Display: "â„ï¸ frozen ğŸ¦‰ owl"

  RESULT:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ğŸ”¥ blazing (abc1234)     â”‚ â„ï¸ frozen (def5678)      â”‚
  â”‚   â””â”€â”€ ğŸ¦Š fox             â”‚   â”œâ”€â”€ ğŸ» bear            â”‚
  â”‚       (old code)         â”‚   â””â”€â”€ ğŸ¦‰ owl             â”‚
  â”‚                          â”‚       (new code)         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Lifecycle

```
  BUILD                    START SERVER               CLIENT CONNECTS
  â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  cargo build              jcode serve                jcode
       â”‚                        â”‚                         â”‚
       â–¼                        â”œâ”€â–¶ Generate name         â”œâ”€â–¶ Read registry
  ~/.jcode/bin/                 â”œâ”€â–¶ Create socket         â”œâ”€â–¶ Pick server
  jcode-<hash>                  â”œâ”€â–¶ Register              â””â”€â–¶ Connect
                                â””â”€â–¶ Listen


  SERVER SHUTDOWN
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Idle timeout or manual stop
       â”‚
       â”œâ”€â–¶ Save session state
       â”œâ”€â–¶ Remove from registry
       â””â”€â–¶ Delete socket
```

## Session Picker UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Select session:                                                â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”¥ blazing (v0.1.122 abc1234) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚     ğŸ¦Š fox          2 hours ago                                 â”‚
â”‚                                                                 â”‚
â”‚  â„ï¸ frozen (v0.1.123 def5678) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚     ğŸ» bear         5 mins ago                                  â”‚
â”‚     ğŸ¦‰ owl          1 min ago                                   â”‚
â”‚                                                                 â”‚
â”‚  â–º + New session (latest: â„ï¸ frozen)                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Behaviors

| Scenario | Behavior |
|----------|----------|
| Same git hash | Reuse existing server |
| New git hash | Spawn new server |
| `/reload` | Hot reload, same server |
| All sessions closed | Idle timeout â†’ shutdown |
| Resume old session | Works on any server |
